<?php    $sede = $_SESSION["sede"];    $estado = "1";    if (count($_POST) > 0) {        $estado = $_POST["estado"];    }    $lstPiso = PisoSedeData::getPisoXSede($sede);    $lstEstado = EstadoData::getAll();    $lstCaja = CajaData::getAll($estado, $sede);?><section class="content">	<div class="row">		<div class="col-md-12">			<div class="panel panel-primary">    			<div class="panel-heading" style="background-color: #3c8dbc;"><h3 class="panel-title">Caja</h3></div>    			<div class="panel-body">    				<form class="form-horizontal" method="post" id="boxs" action="" role="form" autocomplete="off">    			            			<div class="form-group">            				<div class="col-md-2 col-sm-12">    							<label for="estado">Estado :</label>    							<select id="estado" name="estado" class="form-control">    								<option value="">TODOS</option>    								<?php foreach ($lstEstado as $objEstado) { ?>    								<option value="<?php echo $objEstado->id; ?>" <?php if ($objEstado->id == $estado) { echo "selected"; } ?>><?php echo $objEstado->nombre; ?></option>      								<?php } ?>    							</select>    						</div>    						<div class="col-md-10 col-sm-12" style="padding-top: 25px;">        						<button type="button" id="btnBuscar" class="btn btn-success" title="Buscar"><em class="fa fa-search"></em></button>        						<button type="button" id="btnLimpiar" class="btn btn-danger" title="Limpiar"><em class="fa fa-eraser"></em></button>        						<button type="button" id="btnNuevo" class="btn btn-primary" title="Nuevo" data-toggle="modal" data-target="#exampleModal"><em class="fa fa-pencil-square-o"></em></button>        						<script type="text/javascript">        							$("#btnBuscar").click(function(){            							$.blockUI();            		    				$("button").prop("disabled", true);            		    				$("#boxs").submit();            		    			});            						$("#btnLimpiar").click(function(){            							$.blockUI();            							$("button").prop("disabled", true);            		    				location.href = "./index.php?view=boxs";            		    			});        						</script>            				</div>    					</div>            		</form>					<div class="table-responsive">        				<div class="box-body">        					<table class="table table-bordered table-hover datatable table-nowrap">        						<thead>        							<tr>        								<th scope="col">Código</th>        								<th scope="col">Piso</th>        								<th scope="col">Nombre</th>        								<th scope="col">Estado</th>        								<th scope="col">Acciones</th>        							</tr>        						</thead>        						<tbody>        						<?php        						    foreach ($lstCaja as $objCaja) {        						        $objPiso = $objCaja->getPiso();        						        $objEstado = $objCaja->getEstado();        						                                        ?>        							<tr>            							<td style="text-align: left;"><?php echo str_pad($objCaja->id, 8, "0", STR_PAD_LEFT); ?></td>            							<td style="text-align: left;"><?php echo $objPiso->nombre; ?></td>            							<td style="text-align: left;"><?php echo $objCaja->nombre; ?></td>            							<td style="text-align: left;"><?php echo $objEstado->nombre; ?></td>            							<td style="text-align: left;">            								<?php if ($objEstado->opcion) { ?>            								<a href="#" class="btn btn-warning btn-xs" data-toggle="modal" data-target="#exampleModal<?php echo $objCaja->id; ?>" title="Editar"><em class="fa fa-pencil-square-o"></em></a>            								<a id="lnkdel<?php echo $objCaja->id; ?>" title="Anular" class="btn btn-danger btn-xs"><em class="fa fa-trash"></em></a>            								<script type="text/javascript">                        						$("#lnkdel<?php echo $objCaja->id; ?>").click(function() {                        							Swal.fire({                            							title: "Desea anular la caja <?php echo $objCaja->nombre; ?>",                        								icon: "warning",                        								showCancelButton: true,                        								confirmButtonColor: "#3085d6",                        								cancelButtonColor: "#d33",                        								confirmButtonText: "Anular",                        								cancelButtonText: "Cancelar"                        							}).then((result) => {                        								if (result.isConfirmed) {                        									$.ajax({                        									    type: "post",                        									    url: "./?action=addbox",                        									    dataType: "html",                        									    data: "id=<?php echo $objCaja->id; ?>&accion=2",                        									    beforeSend: function() {                        									    	$("#lnkdel<?php echo $objCaja->id; ?>").attr("disabled","disabled");                        		    		    					$.blockUI();                        		    		    				},                        									    success: function(data) {                        									        if (data > 0) {                        									        	Swal.fire({                                    		                                icon: "success",                                    		                                title: "Se anuló correctamente la caja <?php echo $objCaja->nombre; ?>",                                    										showCancelButton: false,                                    										confirmButtonColor: "#3085d6",                                    										confirmButtonText: "OK"                                    		                        	}).then((result) => {                                    										window.location.href = "./index.php?view=boxs";                                    		                        	})                        									        } else {                        									        	Swal.fire({                        		    		    							icon: "warning",                        		    		    							title: "Ocurrio un error al anular la caja <?php echo $objCaja->nombre; ?>"                        		    		    						})                        										    }                        									    },                        									    error: function() {                        									    	Swal.fire({                        	    		    							icon: "error",                        	    		    							title: "Ocurrio un error al anular la caja <?php echo $objCaja->nombre; ?>"                        	    		    						})                        									                                									    },                        									    complete: function(data) {                        									    	$("#lnkdel<?php echo $objCaja->id; ?>").removeAttr("disabled");                        		    		    					$.unblockUI();                        		    		    				}                        									});                        								}                        							})                        						});                        					</script>                        					<?php } ?>            							</td>        							</tr>        						<?php                                    }                                ?>                                </tbody>        					</table>        				</div>        			</div>        		</div>        	</div>		</div>	</div>	<!-- Modal Registrar -->	<script type="text/javascript">    	$(function(){        	$("#exampleModal").on("shown.bs.modal", function() {      			$("#nombre").focus();    		})        });	</script>	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false">		<div class="modal-dialog modal-dialog-centered" role="document">        	<div class="modal-content">          		<div class="modal-header btn-primary">            		<h5 class="modal-title" id="exampleModalLabel"><strong>Registrar Caja</strong></h5>          		</div>          		<div class="modal-body">					<div class="row">						<div class="col-md-12">							<form class="form-horizontal" method="post" id="modalcaja" action="" autocomplete="off">								<div class="form-group">									<div class="col-md-4 col-sm-12">                            			<label for="piso">Piso :*</label>                    					<select id="piso" name="piso" required class="form-control">                    					<option value="">SELECCIONE</option>                							<?php foreach ($lstPiso as $objPiso) { ?>            								<option value="<?php echo $objPiso->getPiso()->id; ?>"><?php echo $objPiso->getPiso()->nombre; ?></option>                  							<?php } ?>                    					</select>									</div>        							<div class="col-md-6 col-sm-12">                            			<label for="nombre">Nombre :*</label>                            			<input type="text" id="nombre" name="nombre" class="form-control" placeholder="Nombre" maxlength="100" value="" required/>									</div>								</div>							</form>						</div>					</div>          		</div>          		<div class="modal-footer">                    <button type="button" id="btnGuardar" class="btn btn-primary">Guardar</button>                    <button type="button" id="btnCerrar" class="btn btn-danger" data-dismiss="modal">Cerrar</button>                    <input type="hidden" id="sede" name="sede" value="<?php echo $sede; ?>"/>                                        <script type="text/javascript">                    	$("#btnCerrar").click(function(){                    		$("#piso").val("");                        	$("#nombre").val("");                    	});						$("#btnGuardar").click(function(){							var sede = $("#sede").val();							var piso = $("#piso").val();							var nombre = $("#nombre").val();							var nompiso = $("#piso option:selected").text();							if (piso === "") {								document.getElementById("piso").focus();								Swal.fire({									icon: "warning",									title: "Campo obligatorio (piso)"								})							} else if (nombre === "") {								document.getElementById("nombre").focus();								Swal.fire({									icon: "warning",									title: "Campo obligatorio (nombre)"								})							} else {								$.ajax({	    		    				type: "POST",	    		    				url: "./index.php?action=addbox",	    		    				dataType: "html",	    		    				data: "id=0&accion=1&sede="+sede+"&piso="+piso+"&nombre="+nombre,	    		    				beforeSend: function() {	    		    					$("#btnGuardar").attr("disabled", "disabled");	    		    					$("#btnCerrar").attr("disabled", "disabled");	    		    					$.blockUI();	    		    				},	    		    				success: function(data) {	    		    					document.getElementById("piso").focus();	    		    					if (data > 0) {	    		    						$("#exampleModal").hide();	    		        					Swal.fire({	    		                                icon: "success",	    										title: "Se registró correctamente la caja",	    										showCancelButton: false,	    										confirmButtonColor: "#3085d6",	    										confirmButtonText: "OK"	    		                        	}).then((result) => {	    										window.location.href = "./index.php?view=boxs";	    		                        	})	    		        				} else if (data < 0) {	    		        					Swal.fire({	    		    							icon: "warning",	    		    							title: "Actualmente ya existe una caja con los mismos datos"	    		    						})	    		        				} else {	    		        					Swal.fire({	    		    							icon: "warning",	    		    							title: "Ocurrio un error al registrar la caja"	    		    						})	    		        				}	    		    				},	    		    				error: function(data) {	    		    					document.getElementById("piso").focus();	    		    					Swal.fire({	    									icon: "error",	    									title: "Ocurrio un error al registrar la caja"	    								})	    		    				},	    		    				complete: function(data) {	    		    					$("#btnGuardar").removeAttr("disabled");	    		    					$("#btnCerrar").removeAttr("disabled");	    		    					$.unblockUI();	    		    				}	    		    			});							}						});                    </script>				</div>			</div>		</div>	</div>	<!-- Modal Editar -->	<?php foreach ($lstCaja as $objCaja) { ?>	<script type="text/javascript">    	$(function(){        	$("#exampleModal<?php echo $objCaja->id; ?>").on("shown.bs.modal", function() {      			$("#abreviatura<?php echo $objCaja->id; ?>").focus();    		})        });	</script>	<div class="modal fade" id="exampleModal<?php echo $objCaja->id; ?>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false">		<div class="modal-dialog modal-dialog-centered" role="document">        	<div class="modal-content">          		<div class="modal-header btn-primary">            		<h5 class="modal-title" id="exampleModalLabel"><strong>Editar Caja</strong></h5>          		</div>          		<div class="modal-body">					<div class="row">						<div class="col-md-12">							<form class="form-horizontal" method="post" id="modalcaja<?php echo $objCaja->id; ?>" action="" autocomplete="off">																<div class="form-group">									<div class="col-md-4 col-sm-12">                            			<label for="piso">Piso :*</label>                    					<select id="piso<?php echo $objCaja->id; ?>" name="piso<?php echo $objCaja->id; ?>" required class="form-control">                    					<option value="">SELECCIONE</option>                							<?php foreach ($lstPiso as $objPiso) { ?>            								<option value="<?php echo $objPiso->getPiso()->id; ?>" <?php if ($objPiso->getPiso()->id == $objCaja->piso) { echo "selected"; } ?>><?php echo $objPiso->getPiso()->nombre; ?></option>                  							<?php } ?>                    					</select>									</div>        							<div class="col-md-6 col-sm-12">                            			<label for="nombre">Nombre :*</label>                            			<input type="text" id="nombre<?php echo $objCaja->id; ?>" name="nombre<?php echo $objCaja->id; ?>" class="form-control" placeholder="Nombre" maxlength="100" value="<?php echo $objCaja->nombre; ?>" required/>									</div>								</div>							</form>						</div>					</div>          		</div>          		<div class="modal-footer">                    <button type="button" id="btnGuardar<?php echo $objCaja->id; ?>" class="btn btn-primary">Guardar</button>                    <button type="button" id="btnCerrar<?php echo $objCaja->id; ?>" class="btn btn-danger" data-dismiss="modal">Cerrar</button>                    <input type="hidden" id="sede<?php echo $objCaja->id; ?>" name="sede<?php echo $objCaja->id; ?>" value="<?php echo $sede; ?>"/>                    <script type="text/javascript">                        $("#btnCerrar<?php echo $objCaja->id; ?>").click(function(){                        	$("#piso<?php echo $objCaja->id; ?>").val("<?php echo $objCaja->piso; ?>");                        	$("#nombre<?php echo $objCaja->id; ?>").val("<?php echo $objCaja->nombre; ?>");                    	});						$("#btnGuardar<?php echo $objCaja->id; ?>").click(function(){							var sede = $("#sede<?php echo $objCaja->id; ?>").val();							var piso = $("#piso<?php echo $objCaja->id; ?>").val();							var nombre = $("#nombre<?php echo $objCaja->id; ?>").val();							var nompiso = $("#piso<?php echo $objCaja->id; ?> option:selected").text();														if (piso === "") {								document.getElementById("piso<?php echo $objCaja->id; ?>").focus();								Swal.fire({									icon: "warning",									title: "Campo obligatorio (piso)"								})							} else if (nombre === "") {								document.getElementById("nombre<?php echo $objCaja->id; ?>").focus();								Swal.fire({									icon: "warning",									title: "Campo obligatorio (nombre)"								})							} else {								$.ajax({	    		    				type: "POST",	    		    				url: "./index.php?action=addbox",	    		    				dataType: "html",	    		    				data: "id=<?php echo $objCaja->id; ?>&accion=1&sede="+sede+"&piso="+piso+"&nombre="+nombre,	    		    				beforeSend: function() {	    		    					$("#btnGuardar<?php echo $objCaja->id; ?>").attr("disabled", "disabled");	    		    					$("#btnCerrar<?php echo $objCaja->id; ?>").attr("disabled", "disabled");	    		    					$.blockUI();	    		    				},	    		    				success: function(data) {	    		    					document.getElementById("piso<?php echo $objCaja->id; ?>").focus();	    		        				if (data > 0) {	    		        					$("#exampleModal<?php echo $objCaja->id; ?>").hide();	    		        					Swal.fire({	    		                                icon: "success",	    										title: "Se actualizó correctamente la caja",	    										showCancelButton: false,	    										confirmButtonColor: "#3085d6",	    										confirmButtonText: "OK"	    		                        	}).then((result) => {	    										window.location.href = "./index.php?view=boxs";	    		                        	})	    		        				} else if (data < 0) {	    		        					Swal.fire({	    		    							icon: "warning",	    		    							title: "Actualmente ya existe una caja con los mismos datos"	    		    						})	    		        				} else {	    		        					Swal.fire({	    		    							icon: "warning",	    		    							title: "Ocurrio un error al actualizar la caja"	    		    						})	    		        				}	    		    				},	    		    				error: function(data) {	    		    					document.getElementById("piso<?php echo $objCaja->id; ?>").focus();	    		    					Swal.fire({	    									icon: "error",	    									title: "Ocurrio un error al actualizar la caja"	    								})	    		    				},	    		    				complete: function(data) {	    		    					$("#btnGuardar<?php echo $objCaja->id; ?>").removeAttr("disabled");	    		    					$("#btnCerrar<?php echo $objCaja->id; ?>").removeAttr("disabled");	    		    					$.unblockUI();	    		    				}	    		    			});							}						});                    </script>				</div>			</div>		</div>	</div>	<?php } ?></section>