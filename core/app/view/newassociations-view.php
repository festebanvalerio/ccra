<?php    $id = 0;    $nombre = "";     $texto = "Registrar Módulos - Perfil";    if (isset($_GET["id"])) {        $id = $_GET["id"];                $objPerfil = PerfilData::getById($id);        $nombre = $objPerfil->nombre;                $lstModuloXPerfil = ModuloPerfilData::getAllByPerfil($id);    }    $lstModulos = ModuloData::getAllPrincipal();?><style type="text/css">    a:hover {        color : #FFF;    }    a {        text-decoration: none;        color :#FFF;      }</style>    <section class="content">		<div class="row">		<div class="col-md-12">    		<form class="form-horizontal" method="post" id="newassociation" action="" role="form" autocomplete="off">    		<div class="panel panel-primary">				<div class="panel-heading" style="background-color: #3c8dbc;"><h3 class="panel-title"><?php echo $texto; ?></h3></div>        		<div class="panel-body">        			<div class="form-group">        			        				<div class="col-md-2 col-sm-12">        					<label for="perfil">Perfil :</label>        					<input type="text" id="perfil" name="perfil" class="form-control" value="<?php echo $nombre; ?>" disabled/>        				</div>        				<div class="col-md-4 col-sm-12">        					<label for="modulo">Módulo :</label>						    						<select id="modulo" name="modulo" class="form-control">        						<option value="">-- SELECCIONE --</option>                					<?php foreach ($lstModulos as $objModulo) { ?>            					<option value="<?php echo $objModulo->id; ?>"><?php echo $objModulo->nombre; ?></option>								<?php } ?>        					</select>        					<script type="text/javascript">								$("#modulo").change(function(){									var modulo = $("#modulo").val();									if (modulo !== "") {										$.blockUI();										$.get("./?action=getdetailmodule","modulo="+$("#modulo").val()+"&opcion=0",function(data){											if (data !== "") {    											$("#divModuloHijo").css("display", "block");    											$("#modulohijo").html(data);    																						} else {												$("#divModuloHijo").css("display", "none");												$("#modulohijo").html("");												$("#select2-modulohijo-container").html("");											}											$.unblockUI();			            				});			            				$("#btnAgregar").removeAttr("disabled");									} else {										$("#divModuloHijo").css("display", "none");										$("#modulohijo").html("");										$("#select2-modulohijo-container").html("");										$("#btnAgregar").prop("disabled", true);									}								});        					</script>        				</div>        				<div id="divModuloHijo" class="col-md-4 col-sm-12" style="display: none;">        					<label for="modulo">Módulo Hijo :</label>    						<select id="modulohijo" name="modulohijo" class="form-control"></select>        					        				</div>        				<div class="col-md-2 col-sm-12" style="padding-top: 25px;">        				        					<button type="button" id="btnAgregar" class="btn btn-success" title="Agregar" disabled><em class="fa fa-plus"></em></button>        					<button type="button" id="btnRegresar" class="btn btn-primary" title="Regresar"><em class="fa fa-reply"></em></button>        					        					<script type="text/javascript">								$("#btnAgregar").click(function(){									var validaciones = true;									var moduloHijo = $("#modulohijo").val();									if (moduloHijo === null) {										validaciones = false;										moduloHijo = "";									} else if (moduloHijo === "") {										validaciones = false;										Swal.fire({											icon: "warning",                        		    		title: "Seleccionar el módulo"                        		    	})									}									var texto = $("#modulohijo option:selected").html();									if (validaciones) {    									Swal.fire({                							title: "Desea registrar el módulo " + texto,            								icon: "warning",            								showCancelButton: true,            								confirmButtonColor: "#3085d6",            								cancelButtonColor: "#d33",            								confirmButtonText: "Aceptar",            								cancelButtonText: "Cancelar"            							}).then((result) => {            								if (result.isConfirmed) {									        										$.get("./?action=getdetailmodule","perfil="+$("#id").val()+"&moduloP="+$("#modulo").val()+"&moduloH="+moduloHijo+"&opcion=1",function(data){        											if (data === "existe") {        												Swal.fire({            												icon: "warning",                                    		    		   	title: "El módulo seleccionado ya está asociado al perfil"                                    		    		})            										} else if (data === "ok") {            											Swal.fire({                    		                                icon: "success",                    		                                title: "Se agregó correctamente el módulo",                    										showCancelButton: false,                    										confirmButtonColor: "#3085d6",                    										confirmButtonText: "OK"                    		                        	}).then((result) => {                    										window.location.href = "./index.php?view=newassociations&id="+$("#id").val();                    		                        	})            										} else if (data === "error") {            											Swal.fire({            												icon: "error",                                    		    		   	title: "Ocurrio un error, comunicarse con el administrador"                                    		    		})    											            										}        			            				});    										}    									})									}								});        					</script>        				</div>        			</div>        			<div class="form-group">            			<div class="col-md-12 col-sm-12">      						<div class="panel panel-primary" id="test1Pane1">        						<div class="panel-heading">        							<strong>Listado Módulos</strong>          							<a data-target="#panel1Content" data-parent="#test1Panel" data-toggle="collapse"><span class="pull-right"><em class="panel1Icon fa fa-arrow-up"></em></span> </a>        						</div>        						<div class="panel-collapse collapse in" id="panel1Content">                                	<div class="panel-body">                                    	<div class="table-responsive-md table-responsive" id="tabla">                                    	<?php if (count($lstModuloXPerfil) > 0) { ?>                                    	<table class="table table-hover">                                            <thead>                                                <tr class="btn-primary">                                                	<th scope="col">Icono</th>                                                    <th scope="col">Módulo Padre</th>                                                    <th scope="col">Icono</th>                                                    <th scope="col">Módulo</th>                                                    <th scope="col">Orden</th>                                                    <th scope="col">URL</th>                                                    <th scope="col">Acciones</th>                                                </tr>                                            </thead>                                            <tbody>                        					<?php                                                foreach ($lstModuloXPerfil as $objModuloXPerfil) {                                                    $objModulo = $objModuloXPerfil->getModulo();                                            ?>                                    			<tr>                                    				<td></td>                                                    <td></td>                                                    <td style="text-align: left;"><?php echo $objModulo->icono; ?></td>                                                    <td style="text-align: left;"><?php echo $objModulo->nombre; ?></td>                                                    <td style="text-align: left;"><?php echo $objModulo->orden; ?></td>                                                    <td style="text-align: left;"><?php echo $objModulo->url; ?></td>                                                    <td>                                                    	<a id="lnkdel<?php echo $objModulo->id; ?>" title="Anular" class="btn btn-danger btn-xs"><em class="fa fa-trash"></em></a>                        								<script type="text/javascript">                                    						$("#lnkdel<?php echo $objModulo->id; ?>").click(function() {                                        						Swal.fire({                                        							title: "Desea anular el módulo <?php echo $objModulo->nombre; ?>",                                    								icon: "warning",                                    								showCancelButton: true,                                    								confirmButtonColor: "#3085d6",                                    								cancelButtonColor: "#d33",                                    								confirmButtonText: "Anular",                                    								cancelButtonText: "Cancelar"                                    							}).then((result) => {                                    								if (result.isConfirmed) {                                        								$.get("index.php?action=getdetailmodule", {                                            								id: <?php echo $objModuloXPerfil->id; ?>,                                                							modulo: <?php echo $objModulo->id; ?>,                                                							perfil: <?php echo $id; ?>,                                                							opcion: "2",                                                							indicador: "1"                                            							                                                                        }, function (data) {                                                                            if (data === "ok") {                                                                            	Swal.fire({                                            		                                icon: "success",                                            		                                title: "Se anuló correctamente el módulo <?php echo $objModulo->nombre; ?>",                                            										showCancelButton: false,                                            										confirmButtonColor: "#3085d6",                                            										confirmButtonText: "OK"                                            		                        	}).then((result) => {                                            										window.location.href = "./index.php?view=newassociations&id=<?php echo $id; ?>";                                            		                        	})                                                                            } else {                                                                            	Swal.fire({                                    												icon: "error",                                                            		    		   	title: "Ocurrio un error, comunicarse con el administrador"                                                            		    		})                                                                                                                                    }                                                                        });																	}                                        						})                                    						});                                    					</script>                                                    </td>                                                   </tr>                                            <?php                                                     $lstModuloHijo = ModuloPerfilData::getAllModuloHijos($id, $objModulo->id);                                                    if (count($lstModuloHijo) > 0) {                                                        foreach ($lstModuloHijo as $objModuloHijo) {                                                            $objModuloXHijo = $objModuloHijo->getModulo();                                            ?>                                            	<tr>                                            		<td style="text-align: left;"><?php echo $objModulo->icono; ?></td>                                                    <td style="text-align: left;"><?php echo $objModulo->nombre; ?></td>                                                    <td style="text-align: left;"><?php echo $objModuloXHijo->icono; ?></td>                                                    <td style="text-align: left;"><?php echo $objModuloXHijo->nombre; ?></td>                                                    <td style="text-align: left;"><?php echo $objModuloXHijo->orden; ?></td>                                                    <td style="text-align: left;"><?php echo $objModuloXHijo->url; ?></td>                                                    <td>                                                    	<a id="lnkdel<?php echo $objModuloHijo->id; ?>" title="Anular" class="btn btn-danger btn-xs"><em class="fa fa-trash"></em></a>                        								<script type="text/javascript">                                    						$("#lnkdel<?php echo $objModuloHijo->id; ?>").click(function() {                                    							Swal.fire({                                        							title: "Desea anular el módulo <?php echo $objModuloXHijo->nombre; ?>",                                    								icon: "warning",                                    								showCancelButton: true,                                    								confirmButtonColor: "#3085d6",                                    								cancelButtonColor: "#d33",                                    								confirmButtonText: "Anular",                                    								cancelButtonText: "Cancelar"                                    							}).then((result) => {                                    								if (result.isConfirmed) {                                        								$.get("index.php?action=getdetailmodule", {                                        									id: <?php echo $objModuloHijo->id; ?>,                                                        					modulo: <?php echo $objModulo->id; ?>,                                                                			perfil: <?php echo $id; ?>,                                                							opcion: "2",                                                							indicador: "2"                                                                        }, function (data) {                                                                            if (data === "ok") {                                                                            	Swal.fire({                                            		                                icon: "success",                                            		                                title: "Se anuló correctamente el módulo <?php echo $objModuloXHijo->nombre; ?>",                                            										showCancelButton: false,                                            										confirmButtonColor: "#3085d6",                                            										confirmButtonText: "OK"                                            		                        	}).then((result) => {                                            										window.location.href = "./index.php?view=newassociations&id=<?php echo $id; ?>";                                            		                        	})                                                                            } else {                                                                            	Swal.fire({                                    												icon: "error",                                                            		    		   	title: "Ocurrio un error, comunicarse con el administrador"                                                            		    		})                                                                            }                                                                        });                                                               		}                                        						})                                    						});                                    					</script>                                                    </td>                                                      </tr>                                            <?php                                                         }                                                    }                                                }                                            ?>                                            </tbody>                            			</table>                                    	<?php } ?>                                    	</div>                                    </div>								</div>							</div>                    	</div>                    </div>        			<div class="form-group">        				<div class="col-md-12 col-sm-12">        					<input type="hidden" id="id" name="id" value="<?php echo $id; ?>"/>        					<input type="hidden" id="accion" name="accion" value="1"/>        				</div>        			</div>        		</div>        	</div>    		</form>    		<script type="text/javascript">    			$("#btnRegresar").click(function(){    				$.blockUI();    				$("button").prop("disabled", true);    				location.href = "./index.php?view=profiles";    			});    			$(document).ready(function(){        			$("#panel1Content").on("shown.bs.collapse",function(){        			    $(".panel1Icon").removeClass("fa-arrow-down").addClass("fa-arrow-up");        			});	        			$("#panel1Content").on("hidden.bs.collapse",function(){        			    $(".panel1Icon").removeClass("fa-arrow-up").addClass("fa-arrow-down");        			});    			});    		</script>    	</div>    </div></section>