<?php    $estado = "1";    $fechaInicio = date("d/m/Y");    $fechaFin = date("d/m/Y");    if (count($_POST) > 0) {        $estado = $_POST["estado"];        $fechaInicio = $_POST["fechainicio"];        $fechaFin = $_POST["fechafin"];                $_SESSION["rebates_estado"] = $estado;        $_SESSION["rebates_fechai"] = $fechaInicio;        $_SESSION["rebates_fechaf"] = $fechaFin;    } else {        if (isset($_SESSION["rebates_estado"]) && isset($_SESSION["rebates_fechai"]) && isset($_SESSION["rebates_fechaf"])) {            $estado = $_SESSION["rebates_estado"];            $fechaInicio = $_SESSION["rebates_fechai"];            $fechaFin = $_SESSION["rebates_fechaf"];        }    }    $lstEstado = EstadoData::getAll();    $lstDescuentoProgramado = DescuentoProgramadoData::getAll($estado, $fechaInicio, $fechaFin);?><script type="text/javascript">    $(function() {    	$("#fechainicio").datepicker({    		dateFormat: "dd/mm/yy",    		changeMonth: true,    		changeYear: true,    		    		yearRange: "1900:<?php echo date("Y"); ?>"    	});    	$("#fechafin").datepicker({    		dateFormat: "dd/mm/yy",    		changeMonth: true,    		changeYear: true,    		yearRange: "1900:<?php echo date("Y"); ?>"    	});    });</script><section class="content">	<div class="row">		<div class="col-md-12">			<div class="panel panel-primary">    			<div class="panel-heading" style="background-color: #3c8dbc;"><h3 class="panel-title">Descuento Programado</h3></div>    			<div class="panel-body">    				<form class="form-horizontal" method="post" id="rebates" action="" role="form" autocomplete="off">    			            			<div class="form-group">            				    						<div class="col-md-2 col-sm-12">                				<label for="fecha">Fecha Inicio:</label>        						<input type="text" id="fechainicio" name="fechainicio" value="<?php echo $fechaInicio; ?>" class="form-control" readonly/>        					</div>        					<div class="col-md-2 col-sm-12">                				<label for="fecha">Fecha Fin:</label>        						<input type="text" id="fechafin" name="fechafin" value="<?php echo $fechaFin; ?>" class="form-control" readonly/>        					</div>        					<div class="col-md-2 col-sm-12">    							<label for="estado">Estado :</label>    							<select id="estado" name="estado" class="form-control">    								<option value="">TODOS</option>    								<?php foreach ($lstEstado as $objEstado) { ?>    								<option value="<?php echo $objEstado->id; ?>" <?php if ($objEstado->id == $estado) { echo "selected"; } ?>><?php echo $objEstado->nombre; ?></option>      								<?php } ?>    							</select>    						</div>    						<div class="col-md-6 col-sm-12" style="padding-top: 25px;">    							<button type="button" id="btnBuscar" class="btn btn-success" title="Buscar"><em class="fa fa-search"></em></button>        						<button type="button" id="btnLimpiar" class="btn btn-danger" title="Limpiar"><em class="fa fa-eraser"></em></button>        						<button type="button" id="btnNuevo" class="btn btn-primary" title="Nuevo"><em class="fa fa-pencil-square-o"></em></button>        						<script type="text/javascript">        							$("#btnBuscar").click(function(){            							$.blockUI();            		    				$("button").prop("disabled", true);            		    				$("#rebates").submit();            		    			});            						$("#btnLimpiar").click(function(){            							$.blockUI();            							$("button").prop("disabled", true);            		    				$.post("index.php?action=deletesearch", {                							opcion: "rebates"                							                                        }, function (data) {                                        	location.href = "./index.php?view=rebates";                                        });                                                    		    			});            		    			$("#btnNuevo").click(function(){            							$.blockUI();            							$("button").prop("disabled", true);            		    				location.href = "./index.php?view=newrebate";                                                    		    			});        						</script>            				</div>    					</div>            		</form>					<div class="table-responsive">        				<div class="box-body">        					<table class="table table-bordered table-hover datatable table-nowrap">        						<thead>        							<tr>        								<th scope="col">Código</th>        								<th scope="col">Fecha Inicio</th>        								<th scope="col">Fecha Fin</th>        								<th scope="col">Producto</th>        								<th scope="col" style="text-align: right;">Precio Actual</th>        								<th scope="col" style="text-align: right;">Porcentaje(%)</th>        								<th scope="col" style="text-align: right;">Precio Descuento</th>        								<th scope="col">Estado</th>        								<th scope="col">Acciones</th>        							</tr>        						</thead>        						<tbody>
        						<?php        						    foreach ($lstDescuentoProgramado as $objDescuentoProgramado) {        						        $objEstado = $objDescuentoProgramado->getEstado();        						        $objProducto = $objDescuentoProgramado->getProducto();
                                ?>
        							<tr>            							<td style="text-align: left;"><?php echo str_pad($objDescuentoProgramado->id, 8, "0", STR_PAD_LEFT); ?></td>            							<td style="text-align: left;"><?php echo date("d/m/Y", strtotime($objDescuentoProgramado->fecha_inicio)); ?></td>            							<td style="text-align: left;"><?php echo date("d/m/Y", strtotime($objDescuentoProgramado->fecha_fin)); ?></td>            							<td style="text-align: left;"><?php echo $objProducto->nombre; ?></td>            							<td style="text-align: right;"><?php echo number_format($objDescuentoProgramado->precio_actual, 2); ?></td>            							<td style="text-align: right;"><?php echo number_format($objDescuentoProgramado->porcentaje, 2); ?></td>            							<td style="text-align: right;"><?php echo number_format($objDescuentoProgramado->precio_descuento, 2); ?></td>            							<td style="text-align: left;"><?php echo $objEstado->nombre; ?></td>            							<td style="text-align: left;">            								<?php if ($objEstado->opcion) { ?>            								<a href="index.php?view=newrebate&id=<?php echo $objDescuentoProgramado->id; ?>" title="Editar" class="btn btn-warning btn-xs"><em class="fa fa-pencil-square-o"></em></a>            								<a id="lnkdel<?php echo $objDescuentoProgramado->id; ?>" title="Anular" class="btn btn-danger btn-xs"><em class="fa fa-trash"></em></a>            								<script type="text/javascript">                								$("#lnkdel<?php echo $objDescuentoProgramado->id; ?>").click(function() {                        							Swal.fire({                            							title: "Desea anular el descuento programado asociado al producto <?php echo $objProducto->nombre; ?>",                        								icon: "warning",                        								showCancelButton: true,                        								confirmButtonColor: "#3085d6",                        								cancelButtonColor: "#d33",                        								confirmButtonText: "Anular",                        								cancelButtonText: "Cancelar"                        							}).then((result) => {                        								if (result.isConfirmed) {                        									$.ajax({                        		    		    				type: "POST",                        		    		    				url: "./index.php?action=addrebate",                        		    		    				dataType: "html",                        		    		    				data: "id=<?php echo $objDescuentoProgramado->id; ?>&accion=2",                        		    		    				beforeSend: function() {                        		    		    					$("#lnkdel<?php echo $objDescuentoProgramado->id; ?>").attr("disabled","disabled");                        		    		    					$.blockUI();                        		    		    				},                        		    		    				success: function(data) {                        		    		        				if (data > 0) {                        		    		        					Swal.fire({                        		    		                                icon: "success",                        		    		                                title: "Se anuló correctamente el descuento programado asociado al producto <?php echo $objProducto->nombre; ?>",                        		    										showCancelButton: false,                        		    										confirmButtonColor: "#3085d6",                        		    										confirmButtonText: "OK"                        		    		                        	}).then((result) => {                        		    										window.location.href = "./index.php?view=rebates";                        		    		                        	})                        		    		        				} else {                        		    		        					Swal.fire({                        		    		    							icon: "warning",                        		    		    							title: "Ocurrio un error al anular el descuento programado asociado al producto <?php echo $objProducto->nombre; ?>"                        		    		    						})                        		    		        				}                        		    		    				},                        		    		    				error: function(data) {                        		    		    					Swal.fire({                        		    									icon: "error",                        		    									title: "Ocurrio un error al anular el descuento programado asociado al producto <?php echo $objProducto->nombre; ?>"                        		    								})                        		    		    				},                        		    		    				complete: function(data) {                        		    		    					$("#lnkdel<?php echo $objDescuentoProgramado->id; ?>").removeAttr("disabled");                        		    		    					$.unblockUI();                        		    		    				}                        		    		    			});                        								}                        							})                        						});                        					</script>                        					<?php } ?>            							</td>        							</tr>
        						<?php
                                    }
                                ?>                                </tbody>
        					</table>        				</div>        			</div>        		</div>        	</div>
		</div>	</div></section>